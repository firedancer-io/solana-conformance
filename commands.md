# `solana-test-suite`

Validate effects from clients using InstrContext Protobuf messages.

**Usage**:

```console
$ solana-test-suite [OPTIONS] COMMAND [ARGS]...
```

**Options**:

* `--install-completion`: Install completion for the current shell.
* `--show-completion`: Show completion for the current shell, to copy it or customize the installation.
* `--help`: Show this message and exit.

**Commands**:

* `create-fixtures`: Create test fixtures from a directory of...
* `debug-instr`
* `decode-protobuf`: Convert InstrContext messages to...
* `exec-instr`: Execute InstrContext message(s) and print...
* `instr-from-fixtures`: Extract InstrContext messages from fixtures.
* `list-harness-types`: List harness types available for use.
* `run-tests`: Run tests on a set of targets with a...

## `solana-test-suite create-fixtures`

Create test fixtures from a directory of InstrContext messages.
Effects are generated by the target passed in with --solana-target or -s. 
You can also pass in additional targets with --target or -t 
and use --keep-passing or -k to only generate effects for test cases that match.

**Usage**:

```console
$ solana-test-suite create-fixtures [OPTIONS]
```

**Options**:

* `-i, --input-dir PATH`: Either a file or directory containing InstrContext messages  [default: corpus8]
* `-s, --solana-target PATH`: Solana (or ground truth) shared object (.so) target file path  [default: impl/lib/libsolfuzz_agave_v2.0.so]
* `-t, --target PATH`: Shared object (.so) target file paths (pairs with --keep-passing). Targets must have sol_compat_instr_execute_v1 defined
* `-o, --output-dir PATH`: Output directory for fixtures  [default: test_fixtures]
* `-p, --num-processes INTEGER`: Number of processes to use  [default: 4]
* `-r, --readable`: Output fixtures in human-readable format
* `-k, --keep-passing`: Only keep passing test cases
* `-g, --group-by-program`: Group fixture output by program type
* `--help`: Show this message and exit.

## `solana-test-suite debug-instr`

**Usage**:

```console
$ solana-test-suite debug-instr [OPTIONS]
```

**Options**:

* `-i, --input PATH`: Input file
* `-t, --target PATH`: Shared object (.so) target file path to debug  [default: impl/lib/libsolfuzz_firedancer.so]
* `-d, --debugger TEXT`: Debugger to use (gdb, rust-gdb)  [default: gdb]
* `--help`: Show this message and exit.

## `solana-test-suite decode-protobuf`

Convert InstrContext messages to human-readable format.

**Usage**:

```console
$ solana-test-suite decode-protobuf [OPTIONS]
```

**Options**:

* `-i, --input PATH`: Either a InstrContext message or directory of messages  [default: raw_context]
* `-o, --output-dir PATH`: Output directory for base58-encoded, human-readable InstrContext messages  [default: readable_context]
* `-p, --num-processes INTEGER`: Number of processes to use  [default: 4]
* `--help`: Show this message and exit.

## `solana-test-suite exec-instr`

Execute InstrContext message(s) and print the effects.

**Usage**:

```console
$ solana-test-suite exec-instr [OPTIONS]
```

**Options**:

* `-i, --input PATH`: Input InstrContext file or directory of files
* `-t, --target PATH`: Shared object (.so) target file path to execute  [default: impl/firedancer/build/native/clang/lib/libfd_exec_sol_compat.so]
* `-r, --randomize-output-buffer`: Randomizes bytes in output buffer before shared library execution
* `--help`: Show this message and exit.

## `solana-test-suite instr-from-fixtures`

Extract InstrContext messages from fixtures.

**Usage**:

```console
$ solana-test-suite instr-from-fixtures [OPTIONS]
```

**Options**:

* `-i, --input-dir PATH`: Input directory containing InstrFixture messages  [default: fixtures]
* `-o, --output-dir PATH`: Output directory for InstrContext messages  [default: instr]
* `-p, --num-processes INTEGER`: Number of processes to use  [default: 4]
* `--help`: Show this message and exit.

## `solana-test-suite list-harness-types`

List harness types available for use.

**Usage**:

```console
$ solana-test-suite list-harness-types [OPTIONS]
```

**Options**:

* `--help`: Show this message and exit.

## `solana-test-suite run-tests`

Run tests on a set of targets with a directory of InstrContext 
or InstrFixture messages.

Note: each `.so` target filename must be unique.

**Usage**:

```console
$ solana-test-suite run-tests [OPTIONS]
```

**Options**:

* `-i, --input PATH`: Single input file or input directory containing InstrContext or InstrFixture messages  [default: corpus8]
* `-s, --solana-target PATH`: Solana (or ground truth) shared object (.so) target file path  [default: impl/lib/libsolfuzz_agave_v2.0.so]
* `-t, --target PATH`: Shared object (.so) target file paths  [default: impl/lib/libsolfuzz_firedancer.so]
* `-o, --output-dir PATH`: Output directory for test results  [default: test_results]
* `-p, --num-processes INTEGER`: Number of processes to use  [default: 4]
* `-r, --randomize-output-buffer`: Randomizes bytes in output buffer before shared library execution
* `-c, --chunk-size INTEGER`: Number of test results per file  [default: 10000]
* `-v, --verbose`: Verbose output: log failed test cases
* `-c, --consensus-mode`: Only fail on consensus failures. One such effect is to normalize error codes when comparing results
* `-f, --failures-only`: Only log failed test cases
* `-sf, --save-failures`: Saves failed test cases to results directory
* `--help`: Show this message and exit.
